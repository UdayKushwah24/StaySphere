<% layout("/layouts/boilerplate") -%>

    <style>
        #filters {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter {
           
           text-align: center;
            margin-right: 2rem;
            margin-top: 2rem;
            opacity: 0.8;
            color: #333;
            text-decoration: none; /* remove default underline */
            display: inline-block;
        }

        /* ensure no underline on hover/focus/active */
        .filter:hover, .filter:focus, .filter:active {
            opacity: 1;
            cursor: pointer;
            text-decoration: none;
        }

        .filter.active {
            opacity: 1;
            color: #fe424d;
            border-bottom: 2px solid #fe424d;
            padding-bottom: 0.25rem;
            text-decoration: none;
        }

        .filter p {
            font-size: 0.8rem;
            text-decoration: none;
        }

        .tax-info {
            display: none;
        }

        .tax-toggle {
           border : 1px solid #000000;
           border-radius: 1rem;
           height: 3.25rem;
           padding: 1rem;
           margin-left: 3.5rem;
        }
        
    </style>

    <body>

        <!-- <h3 style="margin-left: 30px;">All Listings</h3> -->

        <div id="filters">
            <a href="/listings?category=trending<%= q ? '&q=' + encodeURIComponent(q) : '' %>" data-filter="trending" class="filter <%= category === 'trending' ? 'active' : '' %>">
               <div>  <i class="fa-solid fa-fire"></i>  </div>
                <p> Trending </p>
            </a>
            <a href="/listings?category=room<%= q ? '&q=' + encodeURIComponent(q) : '' %>" data-filter="room" class="filter <%= category === 'room' ? 'active' : '' %>">
               <div>  <i class="fa-solid fa-bed"></i>  </div>
                <p> Room </p>
            </a>
            <a href="/listings?category=iconic-city<%= q ? '&q=' + encodeURIComponent(q) : '' %>" data-filter="iconic-city" class="filter <%= category === 'iconic-city' ? 'active' : '' %>">
               <div>  <i class="fa-solid fa-mountain-city"></i>  </div>
                <p> Iconic City </p>
            </a>
            <a href="/listings?category=mountains<%= q ? '&q=' + encodeURIComponent(q) : '' %>" data-filter="mountains" class="filter <%= category === 'mountains' ? 'active' : '' %>">
               <div>  <i class="fa-solid fa-mountain"></i>  </div>
                <p> Mountains </p>
            </a>
            <a href="/listings?category=castles<%= q ? '&q=' + encodeURIComponent(q) : '' %>" data-filter="castles" class="filter <%= category === 'castles' ? 'active' : '' %>">
               <div>  <i class="fa-solid fa-fort-awesome"></i>  </div>
                <p> Castles </p>
            </a>
            <a href="/listings?category=amazing-pools<%= q ? '&q=' + encodeURIComponent(q) : '' %>" data-filter="amazing-pools" class="filter <%= category === 'amazing-pools' ? 'active' : '' %>">
               <div>  <i class="fa-solid fa-person-swimming"></i>  </div>
                <p> Amazing Pools </p>
            </a>
            <a href="/listings?category=camping<%= q ? '&q=' + encodeURIComponent(q) : '' %>" data-filter="camping" class="filter <%= category === 'camping' ? 'active' : '' %>">
               <div>  <i class="fa-solid fa-campground"></i>  </div>
                <p> Camping </p>
            </a>
            <a href="/listings?category=farms<%= q ? '&q=' + encodeURIComponent(q) : '' %>" data-filter="farms" class="filter <%= category === 'farms' ? 'active' : '' %>">
               <div>  <i class="fa-solid fa-cow"></i>  </div>
                <p> Farms </p>
            </a>
            <a href="/listings?category=arctic<%= q ? '&q=' + encodeURIComponent(q) : '' %>" data-filter="arctic" class="filter <%= category === 'arctic' ? 'active' : '' %>">
               <div>  <i class="fa-solid fa-snowflake"></i>  </div>
                <p> Arctic </p>
            </a>
            <a href="/listings?category=domes<%= q ? '&q=' + encodeURIComponent(q) : '' %>" data-filter="domes" class="filter <%= category === 'domes' ? 'active' : '' %>">
               <div>  <i class="fa-solid fa-igloo"></i>  </div>
                <p> Domes </p>
            </a>
            <a href="/listings?category=boats<%= q ? '&q=' + encodeURIComponent(q) : '' %>" data-filter="boats" class="filter <%= category === 'boats' ? 'active' : '' %>">
               <div>  <i class="fa-solid fa-ship"></i>  </div>
                <p> Boats </p>
            </a>

            <div class="tax-toggle">
                <div class="form-check-reverse form-switch">
                    <input class="form-check-input" type="checkbox" role="switch" id="flexSwitchCheckDefault">
                    <label class="form-check-label" for="flexSwitchCheckDefault">Display total after taxes</label>
                </div>
            </div>

        </div>
        <div class="row row-cols-lg-3 row-cols-md-2 row-cols-sm-1 mt-3">
            <% for(let listing of allListings) { %>

                <a href="/listings/<%= listing._id %>" class="listing-link">
                    <div class="col card listing-card" style="width: 20rem;" >
                        <img src="<%= (listing.image && listing.image.url) ? listing.image.url : 'https://via.placeholder.com/800x600?text=No+Image' %>" class="card-img-top" style="height: 17rem;"
                            alt="<%= listing.title %>">
                        <div class="card-img-overlay"> </div>
                        <div class="card-body">
                            <p class="card-text">
                                <b>
                                    <%= listing.title %> <br>
                                </b>
                                &#8377; <%= listing.price.toLocaleString('en-IN') %> / night

                                <i class="tax-info">&nbsp; &nbsp;+18% GST</i>

                            </p>
                        </div>

                    </div>
                </a>

                <% } %>
        </div>

        <script>
            const taxToggle = document.getElementById('flexSwitchCheckDefault');
            if (taxToggle) {
              taxToggle.addEventListener('click', () => {
                  const taxInfo  = document.querySelectorAll('.tax-info');
                  for(let info of taxInfo) {
                      if(info.style.display == "none") {
                          info.style.display = "inline";
                      } else {
                          info.style.display = "none";
                      }
                  }
              });
            }

            // Enhance filters: clicking a filter will set the hidden category in the search form and submit it (preserves q)
            document.querySelectorAll('.filter[data-filter]').forEach(el => {
              el.addEventListener('click', function (e) {
                const searchForm = document.getElementById('searchForm');
                const categoryInput = document.getElementById('categoryInput');
                if (searchForm && categoryInput) {
                  // prevent anchor default to allow controlled submit which preserves q in the form
                  e.preventDefault();
                  categoryInput.value = this.dataset.filter || '';
                  searchForm.submit();
                }
                // otherwise allow normal navigation via href
              });
            });
        </script>
    </body>
